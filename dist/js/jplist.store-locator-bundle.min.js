/**
 * jPList - jQuery Data Grid Controls
 * jPList Store Locator Bundle 5.2.0.12 - http://jplist.com
 * Copyright 2016 Miriam Zusin
 *
 * Free for non commercial use only
 * To use this file on commercial sites you should purchase a licence at http://jplist.com
 */
(function(){var b=function(a,c){for(var e,f=[],b=0;b<c.length;b++)e=c[b],e=new jQuery.fn.jplist.controls.GoogleMapsControl.StoreModel(e.$item),f.push(e);a.params.mapView.setStores(f)},c=function(a){a.observer.on(a.observer.events.collectionReadyEvent,function(c,e){a.params.dataitems=e.dataitems;b(a,a.params.dataitems)});a.observer.on(a.observer.events.statusesAppliedToList,function(c,e){a.params.dataview=e.dataview;b(a,a.params.dataview)});a.observer.on("jplist.map.store.clicked",function(c,e,f){a.params.mapView.showStore(e,
f,a.params.userSettings.storeZoom)})},d=function(a){a.params={userSettings:{},mapView:null,storesView:null,dataitems:[],dataview:[]};var b=a.params,e;e={latitude:Number(a.$control.attr("data-latitude"))||0,longitude:Number(a.$control.attr("data-longitude"))||0,initialZoom:Number(a.$control.attr("data-initil-zoom"))||2,mapTypeId:a.$control.attr("data-map-type")||"ROADMAP",storeZoom:Number(a.$control.attr("data-store-zoom"))||17,geolocation:"true"===a.$control.attr("data-geolocation"),openInfoWindowOnStoreClick:a.$control.attr("data-open-popup-store-click")||
!1,customMarkerIcon:a.$control.attr("data-marker-icon"),markerText:a.$control.attr("data-marker-text")||"Click to Zoom"};b.userSettings=e;a.params.mapView=new jQuery.fn.jplist.controls.GoogleMapsControl.MapView(a.params.userSettings,a.observer,a.$control);a.params.storesView=new jQuery.fn.jplist.controls.GoogleMapsControl.StoresView(a.params.userSettings,a.observer,a.$root.find(a.options.itemsBox),a.options.itemPath);c(a);return jQuery.extend(this,a)};jQuery.fn.jplist.controls.GoogleMapsControl=function(a){return new d(a)};
jQuery.fn.jplist.controlTypes["google-maps-control"]={className:"GoogleMapsControl",options:{}}})();(function(){var b=function(a,c){for(var b,d=0;d<a.stores.length;d++)b=a.stores[d],b.remove();a.stores=[];a.stores=c;if(a.mapCanvas)for(b=0;b<c.length;b++)d=c[b],d.marker=new jQuery.fn.jplist.controls.GoogleMapsControl.MarkerModel(a.observer,d.longitude,d.latitude,a.mapCanvas,a.userSettings.markerText,d.html)},c=function(a,c,b,d){c=new google.maps.LatLng(c,b);a.mapCanvas.setCenter(c);a.mapCanvas.setZoom(d)},d=function(a){for(var c=0;c<a.stores.length;c++)a.stores[c].closeStorePopup()},a=function(a){a.userSettings.geolocation&&
navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){c(a,b.coords.latitude,b.coords.longitude,a.userSettings.storeZoom)})},g=function(c){window.google&&window.google.maps&&window.google.maps.event.addDomListener(window,"load",function(){var d;d=new google.maps.LatLng(c.userSettings.latitude,c.userSettings.longitude);c.mapCanvas=new window.google.maps.Map(c.$map.get(0),{mapTypeId:google.maps.MapTypeId[c.userSettings.mapTypeId],center:d,zoom:c.userSettings.initialZoom});b(c,c.stores);
a(c)});c.observer.on("jplist.map.marker.clicked",function(a,b,g){d(c)})};jQuery.fn.jplist.controls.GoogleMapsControl.MapView=function(a,c,b){this.userSettings=a;this.$map=b;this.observer=c;this.mapCanvas=null;this.stores=[];g(this)};jQuery.fn.jplist.controls.GoogleMapsControl.MapView.prototype.showLocation=function(a,b,d){c(this,a,b,d)};jQuery.fn.jplist.controls.GoogleMapsControl.MapView.prototype.showStore=function(a,b,g){var h;d(this);for(var k=0;k<this.stores.length;k++)if(h=this.stores[k],h.latitude===
a&&h.longitude===b){c(this,a,b,g);this.userSettings.openInfoWindowOnStoreClick&&h.openStorePopup();break}};jQuery.fn.jplist.controls.GoogleMapsControl.MapView.prototype.setStores=function(a){b(this,a)}})();(function(){var b=function(c){c.$storesPanel.on("click",c.storePath,function(){var b=jQuery(this);c.$storesPanel.find(c.storePath).removeClass("jplist-active-store");b.addClass("jplist-active-store");c.observer.trigger("jplist.map.store.clicked",[Number(b.attr("data-latitude")),Number(b.attr("data-longitude"))])})};jQuery.fn.jplist.controls.GoogleMapsControl.StoresView=function(c,d,a,g){this.userSettings=c;this.observer=d;this.$storesPanel=a;this.storePath=g;b(this)}})();(function(){var b=function(c,b){var a;a=c.$store.find('[data-type="'+b+'"]');return 0<a.length?a.text():null};jQuery.fn.jplist.controls.GoogleMapsControl.StoreModel=function(c){this.marker=null;this.$store=c;this.latitude=Number(this.$store.attr("data-latitude"))||0;this.longitude=Number(this.$store.attr("data-longitude"))||0;this.html=c.html();this.title=b(this,"title");this.address=b(this,"address");this.city=b(this,"city");this.state=b(this,"state");this.zipcode=b(this,"zipcode");this.country=
b(this,"country")};jQuery.fn.jplist.controls.GoogleMapsControl.StoreModel.prototype.openStorePopup=function(){this.marker&&this.marker.openPopup()};jQuery.fn.jplist.controls.GoogleMapsControl.StoreModel.prototype.closeStorePopup=function(){this.marker&&this.marker.closePopup()};jQuery.fn.jplist.controls.GoogleMapsControl.StoreModel.prototype.remove=function(){this.marker&&this.marker.remove()}})();(function(){var b=function(c){window.google.maps.event.addListener(c.gmarker,"click",function(b){c.observer.trigger("jplist.map.marker.clicked");c.gmarker.infowindow.open(c.map,c.gmarker)})};jQuery.fn.jplist.controls.GoogleMapsControl.MarkerModel=function(c,d,a,g,e,f){this.position=new window.google.maps.LatLng(a,d);this.map=g;this.observer=c;this.title=e;this.gmarker=new window.google.maps.Marker({position:this.position,map:this.map,title:this.title});this.gmarker.infowindow=new window.google.maps.InfoWindow;
this.gmarker.infowindow.setContent(f);b(this)};jQuery.fn.jplist.controls.GoogleMapsControl.MarkerModel.prototype.openPopup=function(){window.google.maps.event.trigger(this.gmarker,"click")};jQuery.fn.jplist.controls.GoogleMapsControl.MarkerModel.prototype.closePopup=function(){this.gmarker&&this.gmarker.infowindow&&this.gmarker.infowindow.close()};jQuery.fn.jplist.controls.GoogleMapsControl.MarkerModel.prototype.remove=function(){this.gmarker.setMap(null)}})();(function(){jQuery.fn.jplist.FiltersService=jQuery.fn.jplist.FiltersService||{};jQuery.fn.jplist.FiltersService.autocompleteFilter=function(b,c,d,a,g){var e=[],f,l;if(jQuery.isNumeric(b)&&jQuery.isNumeric(c)&&window.google){b=new google.maps.LatLng(b,c);for(var h=0;h<a.length;h++)c=a[h],f=new jQuery.fn.jplist.controls.GoogleMapsControl.StoreModel(c.jqElement),l=f.country?jQuery.trim(f.country.toLowerCase())==jQuery.trim(d.toLowerCase()):!1,f=new google.maps.LatLng(f.latitude,f.longitude),f=window.google.maps.geometry.spherical.computeDistanceBetween(b,
f),(f<=g||l)&&e.push(c);return e}return a}})();(function(){jQuery.fn.jplist.DTOMapperService=jQuery.fn.jplist.DTOMapperService||{};jQuery.fn.jplist.DTOMapperService.filters=jQuery.fn.jplist.DTOMapperService.filters||{};jQuery.fn.jplist.DTOMapperService.filters.AutocompleteFilter=function(b,c){return jQuery.fn.jplist.FiltersService.autocompleteFilter(b.data.latitude,b.data.longitude,b.data.name,c,b.data.radius)}})();(function(){var b=function(a){a.params.handler&&window.google.maps.event.removeListener(a.params.handler);a.params.handler=window.google.maps.event.addListener(a.params.autocomplete,"place_changed",function(){var b;a.params.place=a.params.autocomplete.getPlace();b=c(a,!1);a.history.addStatus(b);a.observer.trigger(a.observer.events.knownStatusesChanged,[[b]])})},c=function(a,c){var b=null;a.params.place&&(b=new jQuery.fn.jplist.controls.AutocompleteDTO(a.params.place.geometry.location.lat(),a.params.place.geometry.location.lng(),
a.params.place.name,a.params.radius),b=new jQuery.fn.jplist.StatusDTO(a.name,a.action,a.type,b,a.inStorage,a.inAnimation,a.isAnimateToTop,a.inDeepLinking));return b},d=function(a){a.params={autocomplete:null,place:null,zoom:Number(a.$control.attr("data-zoom"))||17,radius:a.$control.attr("data-radius")};window.google&&window.google.maps&&window.google.maps.event.addDomListener(window,"load",function(){a.params.autocomplete=new window.google.maps.places.Autocomplete(a.$control.get(0));b(a)});return jQuery.extend(this,
a)};d.prototype.getStatus=function(a){return c(this,a)};jQuery.fn.jplist.controls.GoogleAutocompleteControl=function(a){return new d(a)};jQuery.fn.jplist.controlTypes["google-autocomplete-control"]={className:"GoogleAutocompleteControl",options:{}}})();(function(){jQuery.fn.jplist.controls.AutocompleteDTO=function(b,c,d,a){return{latitude:b,longitude:c,name:d,radius:a,filterType:"AutocompleteFilter"}}})();
